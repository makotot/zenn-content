---
title: 'react-transition-groupã®Transitionã‚’åˆ©ç”¨ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã¨ã'
emoji: 'ğŸ’¬'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['test', 'react', 'jest']
published: true
---

[react-transition-group](https://reactcommunity.org/react-transition-group/)ã®`<Transition />`ã‚’åˆ©ç”¨ã—ã¦ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ãªãŒã‚‰è¡¨ç¤ºãƒ»éè¡¨ç¤ºã®çŠ¶æ…‹ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹è¦ç´ ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’[Jest](https://jestjs.io/ja/) ã¨ [Testing Library](https://testing-library.com/) ã§ãƒ†ã‚¹ãƒˆã—ãŸã¨ãã€ã©ã®ã‚ˆã†ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºå®Ÿã«å®Œäº†ã•ã›ã¦ã‹ã‚‰ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹ã‚’ç¢ºèªã—ãŸãƒ¡ãƒ¢ã€‚

çŠ¶æ³ã¨ã—ã¦ã¯ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã—ã¦ã‚ã‚‹è¦ç´ ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆã‚’[react-transition-group](https://reactcommunity.org/react-transition-group/)ã®`<Transition />`ã‚’åˆ©ç”¨ã—ã¦è¡Œã£ã¦ã„ã‚‹ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã€‚ `entering: { opacity: 0 }`ã®ã‚ˆã†ã«`entering`ã®æ™‚ç‚¹ã§ã¯ä¸å¯è¦–ã«ã—ã¦ã„ã‚‹ã¨ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ç›´å¾Œã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ã¦ã„ãªã„çŠ¶æ…‹ã«ãªã‚‹ã®ã§ã€ãã®ã¾ã¾`expect(element).toBeVisible()`ã¨ã—ã¦ã‚‚ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã™ã‚‹ã€‚

ã“ã“ã§è¨€åŠã—ã¦ã„ã‚‹ã®ã¯ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚

```tsx
import { useState } from "react";
import Transition from "react-transition-group/Transition";

const duration = 1000;

const defaultStyle = {
  transition: `opacity ${duration}ms ease-in-out`,
  opacity: 0,
};

const transitionStyles = {
  entering: { opacity: 0 },
  entered: { opacity: 1 },
  exiting: { opacity: 0 },
  exited: { opacity: 0 },
};

export const FadeInOut = () => {
  const [inProp, setInProp] = useState(false);

  return (
    <div>
      <Transition
        in={inProp}
        timeout={duration}
        mountOnEnter={true}
        unmountOnExit={true}
      >
        {(state) => (
          <div
            style={{
              ...defaultStyle,
              ...transitionStyles[state as keyof typeof transitionStyles],
            }}
          >
            content
          </div>
        )}
      </Transition>

      <button type="button" onClick={() => setInProp((v) => !v)}>
        toggle
      </button>
    </div>
  );
};
```

ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«è¡¨ç¤ºãƒ»éè¡¨ç¤ºã®çŠ¶æ…‹ãŒ`Transition`ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦åˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€ãŸã `userEvent.click(ãƒœã‚¿ãƒ³è¦ç´ )`ã®ç›´å¾Œã«`expect(ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®è¦ç´ ).toBeVisible()`ã¨ã—ã¦ã‚‚å¯è¦–çŠ¶æ…‹ã«ãªã£ã¦ã„ãªã„ã®ã§ãƒ†ã‚¹ãƒˆã¯å¤±æ•—ã™ã‚‹ã€‚

ãƒ†ã‚¹ãƒˆæ™‚ã«æ™‚é–“ã®çµŒéã‚’å¾…ãŸãªã„ã‚ˆã†ã«ã—ãŸã„ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚‹ã‘ã©ã€ã“ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã§è¦ç´ ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã©ã†ã™ã‚‹ã‹ã€‚\
é¸æŠè‚¢ã¨ã—ã¦ã¯ã€

- react-transition-group ã®`config.disabled`ã‚’åˆ©ç”¨ã™ã‚‹
- å½ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹
- `<Transition />`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè‡ªä½“ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹

ãªã©ãŒã‚ã‚Šãã†ã€‚

## react-transition-group ãŒ v4.1.0 ä»¥ä¸Šã®å ´åˆã€`config.disabled`ãŒåˆ©ç”¨ã§ãã‚‹

[v4.1.0](https://github.com/reactjs/react-transition-group/releases/tag/v4.1.0) ä»¥ä¸Šã§ã‚ã‚Œã°`config.disabled`ã§`entering`ã‚„`existing`ã®é€”ä¸­ã®é·ç§»ã‚’ç„¡åŠ¹ã«ã—ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ http://reactcommunity.org/react-transition-group/testing/ ã‚’è¦‹ã‚‹é™ã‚Šã¯ãƒ†ã‚¹ãƒˆç”¨é€”ã§ä½¿ã‚ã‚Œã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã®ã‚‚ã®ã®ã‚ˆã†ã€‚

```tsx
import { act, render, screen, waitFor } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import { config } from "react-transition-group";
import { FadeInOut } from "./FadeInOut";

describe("config.disabled true", () => {
  beforeAll(() => {
    config.disabled = true;
  });
  afterAll(() => {
    config.disabled = false;
  });

  it("should fade in", async () => {
    render(<FadeInOut />);
    const button = await screen.findByText("toggle");
    expect(button).toBeInTheDocument();

    expect(screen.queryByText("content")).not.toBeInTheDocument();

    userEvent.click(button);

    expect(screen.queryByText("content")).toBeVisible();
  });
});
```

ã“ã‚Œã«ã‚ˆã£ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€”ä¸­ã®ã“ã¨ã¯æ°—ã«ã›ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

## `jest.useFakeTimers`

react-transition-group ãŒ v4.1.0 ä»¥ä¸Šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ãªã„çŠ¶æ³ã§ãƒ†ã‚¹ãƒˆã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã€‚\
Jest ã«é™ã‚‰ãš`setTimeout`ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ãƒ†ã‚¹ãƒˆæ™‚ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’é€²ã‚ã‚‹å½¢ãŒã‚ã‚‹ã€‚

```tsx
describe("jest fakeTimers", () => {
  beforeEach(() => {
    jest.useFakeTimers();
  });
  afterEach(() => {
    jest.runOnlyPendingTimers();
    jest.useRealTimers();
  });

  it("should fade in", async () => {
    render(<FadeInOut />);
    const button = await screen.findByText("toggle");
    expect(button).toBeInTheDocument();

    expect(screen.queryByText("content")).not.toBeInTheDocument();

    userEvent.click(button);
    act(() => {
      jest.advanceTimersByTime(100);
    });

    await waitFor(() => {
      expect(screen.queryByText("content")).toBeVisible();
    });
  });
});
```

`beforeEach`ã§ãƒ†ã‚¹ãƒˆå‰ã«`jest.useFakeTimers()`ã‚’å®Ÿè¡Œã—ã¦ã‚¿ã‚¤ãƒãƒ¼ã‚’å½ç‰©ã«ç½®ãæ›ãˆã¦ã€ã‚¿ã‚¤ãƒãƒ¼ã‚’é€²ã‚ãŸã„ã¨ãã«`jest.advanceTimersByTime(...)`ã§æŒ‡å®šãƒŸãƒªç§’é€²ã‚ã‚‰ã‚‹ã€‚

ãƒ†ã‚¹ãƒˆå¾Œã€å¾…æ©Ÿä¸­ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰æœ¬ç‰©ã®ã‚¿ã‚¤ãƒãƒ¼ã«æˆ»ã—ã¦ãŠã‹ãªã„ã¨äºˆæœŸã—ãªã„å•é¡ŒãŒèµ·ã“ã‚Šå¾—ã‚‹ã®ã§ã€ãã‚Œã‚’é¿ã‘ã‚‹ãŸã‚`afterEach`ã§`jest.runOnlyPendingTimers()`ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰`jest.useRealTimers()`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

> It's important to also call runOnlyPendingTimers before switching to real timers. This will ensure you flush all the pending timers before you switch to real timers. If you don't progress the timers and just switch to real timers, the scheduled tasks won't get executed and you'll get an unexpected behavior. This is mostly important for 3rd parties that schedule tasks without you being aware of it.

https://testing-library.com/docs/using-fake-timers/

## å‚è€ƒè³‡æ–™

- [unit testing - Disable React's CSSTransitionGroup in test - Stack Overflow](https://stackoverflow.com/questions/36550906/disable-reacts-csstransitiongroup-in-test)
- [Jest setTimeout()ã®ã‚ˆã†ãªã§ã‚¿ã‚¤ãƒãƒ¼é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹](https://zenn.dev/azukiazusa/articles/67e059d7b7f3c7)
