---
title: "dioxus"
emoji: "💨"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["dioxus", "rust"]
published: false
---

https://dioxuslabs.com/

> a React-like library for building fast, portable, and beautiful user interfaces with Rust. Runs on the web, desktop, mobile, and more.

dioxusは、Web、デスクトップアプリ、モバイルアプリ、[TUI](https://ja.wikipedia.org/wiki/%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9)などの各プラットフォームに同じ宣言的な記述で対応できる[Rust](https://www.rust-lang.org/)製のライブラリ。
[React](https://reactjs.org/)と同じ、もしくは類似する機能を提供することを重視しているように見える。

## インストール

Rustや[cargo-edit](https://github.com/killercup/cargo-edit)はインストールされている前提で。

dioxusのCLIツールをインストール。

```sh
$ cargo install dioxus-cli
```

Webを対象とする場合は、[WebAssembly](https://webassembly.org/)へのコンパイルが必要なので[wasm32-unknown-unknown](https://doc.rust-lang.org/rustc/platform-support/wasm64-unknown-unknown.html)を追加する。

```sh
$ rustup target add wasm32-unknown-unknown
```

## Hello World

まずはHello Worldから。
https://dioxuslabs.com/guide/hello_world.html

Rustのパッケージマネージャである[`cargo`](https://github.com/rust-lang/cargo)を使ってプロジェクトを作成する。

```sh
$ cargo new hello-dioxus
```

```sh
$ cd hello-dioxus
$ tree .
.
├── Cargo.toml
└── src
    └── main.rs
```

```rust:src/main.rs
fn main() {
    println!("Hello, world!");
}
```

```toml:Cargo.tml
[package]
name = "hello-dioxus"
version = "0.1.0"
edition = "2021"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
```

実行してみると`Hello, World!`が出力される。

```sh
$ cargo run
   Compiling hello-dioxus v0.1.0 (/path/to/hello-dioxus)
    Finished dev [unoptimized + debuginfo] target(s) in 1.48s
     Running `target/debug/hello-dioxus`
Hello, world!
```

依存パッケージとしてdioxusを追加する。

```sh
$ cargo add dioxus --features desktop

    Updating 'https://github.com/rust-lang/crates.io-index' index
      Adding dioxus v0.2.4 to dependencies.
             Features:
             + desktop
             + dioxus-core-macro
             + dioxus-desktop
             + dioxus-hooks
             + dioxus-html
             + hooks
             + html
             + macro
             - ayatana
             - dioxus-interpreter-js
             - dioxus-liveview
             - dioxus-native-core
             - dioxus-native-core-macro
             - dioxus-router
             - dioxus-ssr
             - dioxus-tui
             - dioxus-web
             - fermi
             - liveview
             - native-core
             - router
             - ssr
             - tui
             - web
```

`--features desktop`によってデスクトップアプリ向けのdioxusの依存を解決してくれているということだろうか 🤔

`main.rs`を書き換える。

```rust:src/main.rs
use dioxus::prelude::*;

fn main() {
    dioxus::desktop::launch(app);
}

fn app(cx: Scope) -> Element {
    cx.render(rsx! (
        div { "Hello, world!" }
    ))
}
```

`cargo run`を実行すると`Hello, world!`とだけ表示されるGUIアプリが起動する。

![](https://storage.googleapis.com/zenn-user-upload/73200bd39d26-20220625.png)

何が書かれたのかを確認しておく。

[`prelude`](https://doc.rust-lang.org/reference/names/preludes.html)でdioxusの[trait](https://doc.rust-lang.org/reference/items/traits.html), [macro](https://doc.rust-lang.org/reference/macros.html)などを全て読み込むことになると思う。

```rust
use dioxus::prelude::*;
```

`dioxus::desktop::launch()`によって[Tokio](https://tokio.rs/)ランタイムが起動して、メインスレッドでWebViewのレンダラーが起動する流れらしい。

```rust
dioxus::desktop::launch(app);
```

`app`関数はReactのコンポーネントのコードに近い雰囲気を持っている。
dioxusuの全てのコンポーネントは[`Context`](https://dioxuslabs.com/guide/state/sharedstate.html?highlight=context#provide-context-and-consume-context)と[`Props`](https://dioxuslabs.com/guide/components/propsmacro.html#props)を受け取って[`Element`](https://dioxuslabs.com/guide/elements/vnodes.html)を返すものになる。

```rust
fn app(cx: Scope) -> Element {
    cx.render(rsx! {
        div { "Hello, world!" }
    })
}
```

[`Scope`](https://dioxuslabs.com/guide/interactivity/index.html?highlight=scope#the-scope-object)はReactに存在しないものだけど、変数の状態を維持したり、リスナを管理したりという役割を持つものとして存在するらしい。
おそらく、ただレンダリングして表示するだけであれば`render`メソッドを利用するだけになると思われる。

> For now, just know that Scope lets you store state with hooks and render elements with `cx.render`.
>
> https://dioxuslabs.com/guide/hello_world.html?highlight=scope#hello-world-desktop-app

Reactにおけるhooksの状態を保持することや要素をレンダリングする機能を持っているくらいに理解しておく。
