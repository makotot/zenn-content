---
title: "React v17ã®ç ´å£Šçš„å¤‰æ›´ã«ã¤ã„ã¦æ”¹ã‚ã¦ç¢ºèª"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react"]
published: true
---

v17.0.0ã®ãƒªãƒªãƒ¼ã‚¹ã¯ã‚‚ã†2å¹´è¿‘ãå‰ã®ã“ã¨ã ã—ã€[v18ã‚‚ãƒªãƒªãƒ¼ã‚¹](https://ja.reactjs.org/blog/2022/03/29/react-v18.html)ã•ã‚Œã¦v17ã¯ã‚‚ã†æœ€æ–°ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚‚ãªã„ã®ã§ä»Šæ›´æ„ŸãŒå¼·ã„ã‘ã©ã‚‚ã€æ”¹ã‚ã¦v17ã§ã®ç ´å£Šçš„å¤‰æ›´ã‚’ç¢ºèªã™ã‚‹ã€‚
ä»¥ä¸‹ã®Reactå…¬å¼ã®è¨˜äº‹ã§ç ´å£Šçš„å¤‰æ›´ã«ã¤ã„ã¦ç¢ºèªã—ã¤ã¤ã€å¿…è¦ã«å¿œã˜ã¦StackBlitzã§æŒ™å‹•ã‚’v16ã¨v17ã§æ¯”è¼ƒã™ã‚‹ã€‚

https://ja.reactjs.org/blog/2020/10/20/react-v17.html
https://ja.reactjs.org/blog/2020/08/10/react-v17-rc.html#other-breaking-changes

ãªãŠã€StackBlitzã§ã®æ¤œè¨¼ã®ã‚‚ã®ã¯ãã‚Œãã‚Œä»¥ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`dependencies`ã¨ã—ã¦æŒ‡å®šã—ã¦ã„ã‚‹ã€‚

| react, react-dom | `dependencies` |
| ---------------- | -------------- |
| v16              | `16.14.0`      |
| v17              | `17.0.2`       |

## ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯¾è±¡ãŒReactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒˆè¦ç´ ã«

### v16

@[stackblitz](https://stackblitz.com/edit/react-ts-qzauwm?embed=1&file=App.tsx&ctl=1)

- Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…éƒ¨ã§ç™»éŒ²ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã¯`document`ã«å§”è­²ã•ã‚Œã‚‹
- Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒˆã®è¦ç´ ã‚ˆã‚Šã‚‚è¦ªã®è¦ç´ ã§ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã—ã¦ã„ã‚‹å ´åˆã«ã€Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…éƒ¨ã§ç™»éŒ²ã—ã¦ã„ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãŒé˜»å®³ã•ã‚Œå¾—ã‚‹

### v17

@[stackblitz](https://stackblitz.com/edit/react-ts-3qvwng?embed=1&file=App.tsx&ctl=1)

- Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…éƒ¨ã§ç™»éŒ²ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã¯Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒˆè¦ç´ ã«å§”è­²ã•ã‚Œã‚‹
- å§”è­²å…ˆãŒReactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒˆãªã®ã§ã€Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒˆã®è¦ç´ ã‚ˆã‚Šã‚‚è¦ªã®è¦ç´ ã§ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã—ã¦ã„ã¦ã‚‚ã€Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…éƒ¨ã§ç™»éŒ²ã—ã¦ã„ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãŒé˜»å®³ã•ã‚Œã‚‹ã“ã¨ã¯ãªã„

## scrollã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ–ãƒªãƒ³ã‚°ã‚’å»ƒæ­¢

### v16

@[stackblitz](https://stackblitz.com/edit/react-ts-fxfwph?devToolsHeight=33&embed=1&file=App.tsx&ctl=1)

- å…¨ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒãƒ–ãƒªãƒ³ã‚°ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€`scroll`ã‚¤ãƒ™ãƒ³ãƒˆä¾‹å¤–ã§ã¯ãªããƒãƒ–ãƒªãƒ³ã‚°ã™ã‚‹
- å­è¦ç´ å†…ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã¨ãã«è¦ªè¦ç´ ã§ã‚‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—å¾—ã‚‹
- [`e.target === e.currentTarget`ã«ã‚ˆã‚‹æ¯”è¼ƒ](https://github.com/facebook/react/issues/15723#issuecomment-655177480)ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒv16ã§ã‚ã‚Œã°å›é¿ç­–ã¨ãªã‚Šãã†

### v17

@[stackblitz](https://stackblitz.com/edit/react-ts-knxars?devToolsHeight=33&embed=1&file=App.tsx&ctl=1)

- `scroll`ã‚¤ãƒ™ãƒ³ãƒˆã¯ãƒãƒ–ãƒªãƒ³ã‚°ã—ãªã„ã€[ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãã‚Œ](https://developer.mozilla.org/ja/docs/Web/API/Element/scroll_event)ã¨åŒã˜æŒ™å‹•ã¸å¤‰æ›´ã•ã‚ŒãŸ
- å­è¦ç´ ã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã«è¦ªè¦ç´ ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãªã„

https://github.com/reactjs/rfcs/issues/175

## `onFocus`ã‚’`focusin`ã«ã€`onBlur`ã‚’`focusout`ã«ãã‚Œãã‚Œå¤‰æ›´

- `onFocus` â†’ `focus`ã‚’[`focusin`](https://developer.mozilla.org/ja/docs/Web/API/Element/focusin_event)ã«
- `onBlur` â†’ `blur`ã‚’[`focusout`](https://developer.mozilla.org/ja/docs/Web/API/Element/focusout_event)ã«

> ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¨ `focus` ã¨ã®ä¸»ãªé•ã„ã¯ã€ `focusin` ãŒãƒãƒ–ãƒªãƒ³ã‚°ã‚’è¡Œã†ã®ã«å¯¾ã— `focus` ã¯è¡Œã‚ãªã„ã“ã¨ã§ã™ã€‚
> https://developer.mozilla.org/ja/docs/Web/API/Element/focusin_event

> ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¨ `blur` ã¨ã®ä¸»ãªé•ã„ã¯ã€ `focusout` ãŒãƒãƒ–ãƒªãƒ³ã‚°ã™ã‚‹ã®ã«å¯¾ã— `blur` ã¯ã—ãªã„ã“ã¨ã§ã™ã€‚
> https://developer.mozilla.org/ja/docs/Web/API/Element/focusout_event

ãŸã ã€ReactãŒãƒãƒ–ãƒªãƒ³ã‚°ã¯å¸¸ã«ã•ã›ã¦ã„ãŸã®ã§ã€ä¸Šè¨˜ã®å·®ç•°ãŒè¡¨é¢åŒ–ã™ã‚‹ã“ã¨ã¯ãªã„ã¯ãšã€‚

å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³(v52ä»¥å‰)ã®Firefoxã§ã¯`focusin`ã€`focusout`ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã®ã§ã€React v17ã§Firefox v52ä»¥å‰ã«å¯¾ã™ã‚‹ã‚µãƒãƒ¼ãƒˆã‚’åˆ‡ã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã€‚

> In terms of breaking changes, this change will mean that React will not support Firefox versions earlier than 52. Earlier versions do not support focusin and focusout.
>
> https://github.com/facebook/react/pull/19186

## `on*Capture`ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã§è¡Œã†ã‚ˆã†ã«

`on*Capture`ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã§è¡Œã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
v16ã§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒãƒ–ãƒªãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã§ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã¨ãƒãƒ–ãƒ«ãƒ•ã‚§ãƒ¼ã‚ºã‚’ä»®æƒ³åŒ–ã—ã¦ã„ãŸã‚‰ã—ã„ã€‚

> This is a deparature of the previous logic, which "virtualized" the capture and bubble phases within the native bubble event listener.
>
> https://github.com/facebook/react/pull/19221

## ã‚¤ãƒ™ãƒ³ãƒˆãƒ—ãƒ¼ãƒªãƒ³ã‚°ã®å»ƒæ­¢

### v16

@[stackblitz](https://stackblitz.com/edit/react-ts-hwf4vw?embed=1&file=App.tsx&ctl=1)

- [`SyntheticEvent`](https://ja.reactjs.org/docs/events.html)ã¯å†åˆ©ç”¨ã•ã‚Œã€ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œå¾Œã«éƒ½åº¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’`null`ã«ã™ã‚‹ã®ã§ã€ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œå¾Œã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
- ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œå¾Œã‚‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ã«ã¯`e.persist()`ã‚’å‘¼ã¶ï¼ˆã‚‚ã—ãã¯å¤‰æ•°ã«æŒãŸã›ã¦ãŠãï¼‰å¿…è¦ãŒã‚ã‚‹

### v17

@[stackblitz](https://stackblitz.com/edit/react-ts-usqnee?embed=1&file=App.tsx&ctl=1)

- ã‚¤ãƒ™ãƒ³ãƒˆãƒ—ãƒ¼ãƒªãƒ³ã‚°è‡ªä½“ãŒãªããªã£ãŸ
- `e.persist()`ã¯å®Ÿè¡Œã§ãã‚‹ã‘ã©ã‚‚ã€ã“ã‚Œã‚’å®Ÿè¡Œã—ã¦ã‚‚ä½•ã‚‚ã—ãªã„

https://github.com/facebook/react/pull/18969

## `useEffect`ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’éåŒæœŸã«

### v16

@[stackblitz](https://stackblitz.com/edit/react-ts-eesstg?devToolsHeight=33&embed=1&file=App.tsx&ctl=1)

- å‰¯ä½œç”¨ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¯åŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã¦ã„ãŸ

### v17

@[stackblitz](https://stackblitz.com/edit/react-ts-kmyhkg?devToolsHeight=33&embed=1&file=App.tsx&ctl=1)

- å‰¯ä½œç”¨ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¯å¸¸ã«éåŒæœŸçš„ã«å®Ÿè¡Œ
- å‰¯ä½œç”¨ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§ã¯å‚ç…§ã§ããŸå€¤ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°å®Ÿè¡Œæ™‚ã«`null`ã¨ãªã‚Šå¾—ã‚‹ãŒã€ãã®å€¤ã‚’å¤‰æ•°ã«ä¿æŒã—ã¦ãŠãã“ã¨ã§å›é¿ã§ãã‚‹
- [ESLintã®ãƒ«ãƒ¼ãƒ«](https://github.com/facebook/react/tree/main/packages/eslint-plugin-react-hooks)ãŒå…¥ã£ã¦ã„ã‚Œã°é˜²æ­¢ã§ãã¦ã„ã‚‹ã¯ãš

https://github.com/facebook/react/pull/17925

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§`undefined`ã‚’è¿”ã™ã¨ä¸€è²«ã—ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‚ˆã†å¤‰æ›´

### v16

@[stackblitz](https://stackblitz.com/edit/react-ts-ngfekr?devToolsHeight=33&embed=1&file=App.tsx&ctl=1)

- [`memo`](https://ja.reactjs.org/docs/react-api.html#reactmemo)ã‚„[`forwardRef`](https://ja.reactjs.org/docs/forwarding-refs.html)ã«é™ã‚Šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`undefined`ã‚’`return`ã§ããŸ

### v17

@[stackblitz](https://stackblitz.com/edit/react-ts-wlc2p3?devToolsHeight=33&embed=1&file=App.tsx&ctl=1)

- `memo`ã‚„`forwardRef`å«ã‚ã¦å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`undefined`ã‚’`return`ã§ããªããªã£ãŸ
- ä½•ã‚‚è¿”ã—ãŸããªã„å ´åˆã¯`undefined`ã§ã¯ãªã`null`ã‚’ä½¿ã†

https://github.com/facebook/react/pull/19550

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®æ”¹å–„

ã‚¨ãƒ©ãƒ¼æ™‚ã«æœ¬ç•ªç’°å¢ƒã§ã‚‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåãã®ã¾ã¾ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸçµŒè·¯ã‚’è¿½è·¡ã§ãã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã«ãªã£ãŸã¨ã„ã†ç†è§£ã€‚
ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ–¹æ³•ãŒç ´å£Šçš„ãªå½¢ã§å®Ÿç¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã€ç ´å£Šçš„ãªå¤‰æ›´ã¨ã—ã¦æ‰±ã£ã¦ã„ã‚‹ã‚‰ã—ã„ã€‚

https://github.com/facebook/react/pull/18561

## ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªã‚‚ã®ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤

[React Native for Web](https://github.com/necolas/react-native-web)ã®ã¿ã«é–¢ä¿‚ã™ã‚‹ã¯ãšã€‚
åŠ ãˆã¦`ReactTestUtils.SimulateNative`ã‚‚å‰Šé™¤ã¨ãªã£ã¦ã„ã‚‹ã€‚
ã“ã‚Œã‚‰ã‚’ä½¿ã£ã¦ã„ãªã„é™ã‚Šã‚ã¾ã‚Šæ°—ã«ã™ã‚‹å¿…è¦ãŒãªã•ãã†ã€‚
