---
title: "Node.jsã«ãŠã‘ã‚‹CommonJS or ES moduleã®åˆ¤åˆ¥ã«ã¤ã„ã¦"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nodejs"]
published: false
---

## Node.jsã§ã¯ã©ã®ã‚ˆã†ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç¨®åˆ¥ã‚’åˆ¤å®šã™ã‚‹ã‹

ES moduleã¨ã—ã¦æ‰±ã†ã¨ãã¯ã©ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã‹ã€‚

- æ‹¡å¼µå­ãŒ`.mjs`
- æ‹¡å¼µå­ãŒ`.js`ã§ã€æœ€ã‚‚è¿‘ã„`package.json`ã®`type`ãŒ`module`
- `node index.js --input-type=module`ãŒã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ¸¡ã•ã‚ŒãŸã¨ã

ä¸Šè¨˜ä»¥å¤–ã®ã‚±ãƒ¼ã‚¹ã§ã¯å¾Œæ–¹äº’æ›æ€§ã‚’è€ƒæ…®ã—ã¦å…¨ã¦CommonJSã¨ã—ã¦æ‰±ã†ã€‚æ˜ç¤ºçš„ãªã‚‚ã®ã ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒè©²å½“ã™ã‚‹ã€‚

- æ‹¡å¼µå­ãŒ`.cjs`
- æ‹¡å¼µå­ãŒ`.js`ã§ã€æœ€ã‚‚è¿‘ã„`package.json`ã®`type`ãŒ`commonjs`
- `node index.js --input-type=commonjs`ãŒã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ¸¡ã•ã‚ŒãŸã¨ã

https://nodejs.org/docs/latest-v16.x/api/packages.html#determining-module-system

## `type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

- `package.json`ã«`type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹å ´åˆã€ãã®`package.json`ãŒåŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹æœ€ã‚‚è¿‘ã„ä¸Šä½ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãªã‚‹`.js`ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å½¢å¼ã‚’æ±ºå®šã™ã‚‹ã‚‚ã®ã«ãªã‚‹
  - `type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ`module`
    - `.js`ã®æ‹¡å¼µå­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ESModuleã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹
- `package.json`ã¯ã€ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãã®`.js`ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã‚’èµ·ç‚¹ã«ã—ã¦ãã®1ã¤ä¸Šã®éšå±¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ã—ç¶šã‘ã‚‹
  - æ¢ã™ä¸­ã§æœ€åˆã«è¦‹ã¤ã‹ã£ãŸ`package.json`ã®`type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¦‹ã‚‹
  - è¦‹ã¤ã‹ã£ãŸ`package.json`ã«`type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã—ãªã„ã€ã‚‚ã—ãã¯`commonjs`ã®å ´åˆã€CommonJSã¨ã—ã¦æ‰±ã†
  - `package.json`ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã€CommonJSã¨ã—ã¦æ‰±ã†
- `import './foo.js'`ã§èª­ã¿è¾¼ã‚€ã¨ãã€æœ€ã‚‚è¿‘ã„`package.json`ã®`type`ãŒ`module`ã§ã‚ã‚Œã°ãã‚Œã¯ES moduleã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹
- `type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«é–¢ã‚ã‚‰ãšæ‹¡å¼µå­ãŒ`.mjs`ã¯ES moduleã§æ‰±ã‚ã‚Œã€`.cjs`ã¯CommonJSæ‰±ã„ã«ãªã‚‹

https://nodejs.org/docs/latest-v16.x/api/packages.html#type

---

- https://transitivebullsh.it/javascript-dev-tools-in-2022#b080a09cb46d45aaaa4e64b3edb7652f
- https://bundlers.tooling.report/importing-modules/
- https://webpack.js.org/guides/ecma-script-modules/#flagging-modules-as-esm
- https://github.com/sindresorhus/meta/discussions/15
- https://github.com/mgechev/is-esm
- https://numb86-tech.hatenablog.com/entry/2020/08/07/091142
