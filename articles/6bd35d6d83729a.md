---
title: "Redocly CLI Configurable rulesã§OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’Lintã™ã‚‹"
emoji: "ğŸ„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["openapi", "redocly", "lint"]
published: true
---

ã“ã®è¨˜äº‹ã¯ã€ã‚«ã‚ªãƒŠãƒ“ Advent Calendar 2024ï¼ˆã‚·ãƒªãƒ¼ã‚º1ï¼‰ 11æ—¥ç›®ã§ã™ã€‚

https://qiita.com/advent-calendar/2024/kaonavi

## ã¯ã˜ã‚ã«

[OpenAPI](https://www.openapis.org/)ã‚’ç”¨ã„ãŸã‚¹ã‚­ãƒ¼ãƒé§†å‹•é–‹ç™ºã§ã¯ã€OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã€Œ[Single Source of Truthï¼ˆå”¯ä¸€ã®ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºï¼‰](https://ja.wikipedia.org/wiki/%E4%BF%A1%E9%A0%BC%E3%81%A7%E3%81%8D%E3%82%8B%E5%94%AF%E4%B8%80%E3%81%AE%E6%83%85%E5%A0%B1%E6%BA%90)ã€ã¨ã—ã¦é‡è¦ãªå½¹å‰²ã‚’æ‹…ã†ã¨æ€ã„ã¾ã™ã€‚
APIã®ä»•æ§˜ã‚„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«é›†ç´„ã•ã‚Œã‚‹ã“ã¨ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã¯åŒã˜æƒ…å ±ã‚’å…±æœ‰ã—ã€æ•´åˆæ€§ã‚’ä¿ã¡ãªãŒã‚‰ã®é–‹ç™ºãŒã—ã‚„ã™ããªã‚‹ã§ã—ã‚‡ã†ã€‚
çµæœã¨ã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒãƒ¼åŒæ–¹ã®é–‹ç™ºã‚’éåŒæœŸã«é€²ã‚ã‚‹ã“ã¨ã‚‚å®¹æ˜“ã«ãªã‚Šã€é–‹ç™ºåŠ¹ç‡å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

ã—ã‹ã—ã€OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç²¾åº¦é«˜ãä¸€è²«æ€§ã®ã‚ã‚‹çŠ¶æ…‹ã§ç¶­æŒã—ã€ã‚¹ã‚­ãƒ¼ãƒé§†å‹•é–‹ç™ºã¸æœ‰åŠ¹æ´»ç”¨ã—ç¶šã‘ã‚‹ã“ã¨ã¯åŠ´åŠ›ãŒå¿…è¦ã§ã—ã‚‡ã†ã€‚
ã“ã®ãŸã‚ã€OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨˜è¿°ã«ã¯ãªã‚‹ã¹ãä¸€è²«æ€§ã‚„æ•´åˆæ€§ã‚’ä¿ã¤ä»•çµ„ã¿ãŒã‚ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ãŒã€ãã®å®Ÿç¾æ‰‹æ®µã®1ã¤ã¨ã—ã¦[Redocly CLI](https://redocly.com/docs/cli)ã§Lintãƒ«ãƒ¼ãƒ«ã‚’æŸ”è»Ÿã«è¨­å®šã§ãã‚‹[Configurable rules](https://redocly.com/docs/cli/rules/configurable-rules)ã«ã¤ã„ã¦ç„¦ç‚¹ã‚’å½“ã¦ãŸã„ã¨æ€ã„ã¾ã™ã€‚

:::message
ã“ã“ã§è¨€åŠã™ã‚‹`@redocly/cli`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯`1.26.0`ã§ã™ã€‚
ã¾ãŸã€OpenAPI Specificationã¯ã€[v3.1.1](https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.1.md)ã®æ™‚ç‚¹ã®ã‚‚ã®ã‚’ä¸»ã«å‚ç…§ã—ã¦ã¾ã™ã€‚
:::

## Redocly CLIã¨ã¯ï¼Ÿ

Configurable rulesã®å‰ã«Redocly CLI[^1]ã¨ã¯ä½•ã‹è§¦ã‚Œã¦ãŠãã¾ã™ã€‚

[^1]: [openapi-typescript](https://openapi-ts.dev/)ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹é–‹ç™ºè€…ã«ã¨ã£ã¦ã¯ã€[v7](https://github.com/openapi-ts/openapi-typescript/issues/1368)ã‹ã‚‰ãƒãƒ³ãƒ‰ãƒ«ã‚„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¦èªçŸ¥ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

https://github.com/Redocly/redocly-cli

Redocly CLIã¨ã¯ã€OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚`npm`ã¨ã—ã¦`@redocly/cli`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

```bash
$ npm i @redocly/cli
```

ä¸»ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

- Lintï¼šOpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é™çš„è§£æ[^2]
- Bundleï¼šè¤‡æ•°ã®OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’1ã¤ã«ã¾ã¨ã‚ã‚‹
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼šReDocã‚’ä½¿ã£ã¦ã€HTMLå½¢å¼ã§APIä»•æ§˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆ

[^2]: OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®Lintæ©Ÿèƒ½ã‚’æŒã¤é¡ä¼¼ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã¯[Spectral](https://stoplight.io/open-source/spectral)ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

Redocly CLIã¯ã€ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚ŠOpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ‰±ã†ä¸Šã§éå¸¸ã«å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã¨ãªã‚Šã¾ã™ã€‚

## Lint

ä¸Šè¿°ã®é€šã‚ŠRedocly CLIã«ã¯Lintæ©Ÿèƒ½ãŒã‚ã£ã¦ã€JavaScriptã«å¯¾ã™ã‚‹[ESLint](https://eslint.org/)ã®ã‚ˆã†ã«OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®LintãŒè¨­å®šã§ãã¾ã™ã€‚
Redoclyã«ã‚ˆã£ã¦ç”¨æ„ã—ã¦ã‚ã‚‹[`recommended`](https://redocly.com/docs/cli/rules/recommended)ã®ãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã‚‹ãªã‚‰ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹`redocly.yml`ã«ä»¥ä¸‹ã®è¨˜è¿°ã‚’å…¥ã‚Œã‚‹ã ã‘ã§ã™ã€‚

```yml:redocly.yml
extends:
  - recommended
```

ä¾‹ãˆã°`operationId`ã®é‡è¤‡ã¯[OpenAPIã®ä»•æ§˜ä¸Šè¨±å®¹ã•ã‚Œã¾ã›ã‚“](https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.1.md#operation-object)ãŒã€`recommended`ã«å«ã¾ã‚Œã¦ã„ã‚‹[`operation-operationId-unique`](https://redocly.com/docs/cli/rules/operation-operationId-unique)ã«ã‚ˆã£ã¦æ¤œçŸ¥ã•ã‚Œã¾ã™ã€‚

`openapi.yml`ã«ä»¥ä¸‹ã®ã‚ˆã†ãª`operationId`ã®é‡è¤‡ãŒã‚ã‚Œã°

```yaml:openapi.yml
paths:
  /cars:
    get:
      operationId: Car
      # ...
    post:
      operationId: Car
      # ...
```

`redocly lint`ã‚’å®Ÿè¡Œã™ã‚‹ã¨`operation-operationId-unique`ãƒ«ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

```bash
[5] ../openapi/openapi.yaml:27:7 at #/paths/~1cars/post/Car

Every operation must have a unique `operationId`.

25 |     # ...
26 |   post:
27 |     operationId: Car
28 |     # ...
29 | /ok:

Error was generated by the operation-operationId-unique rule.
```

ã¾ãŸã€ãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã§ã¯ãªãå€‹åˆ¥ã®ãƒ«ãƒ¼ãƒ«æ¯ã«è¨­å®šã—ãŸã„å ´åˆã¯ã€`redocly.yml`ã®`rules`ã¸ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚

```yml
rules:
  operation-operationId-unique: error
```

## Configurable rules

[ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®ãƒ«ãƒ¼ãƒ«](https://redocly.com/docs/cli/rules/built-in-rules)ã ã‘ã§ã‚‚APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’é©åˆ‡ã«è¨˜è¿°ã™ã‚‹ãŸã‚ã®åŠ©ã‘ã«ãªã‚Šã¾ã™ãŒã€ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«ã«ã¯ãªã„ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã—ãŸããªã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚
ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ«ã‚’[ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ](https://redocly.com/docs/cli/custom-plugins/custom-rules)ã—ã¦é©ç”¨ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã›ãšã¨ã‚‚ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ«è¨­å®šãŒConfigurable rulesã®ä»•çµ„ã¿ã§å¯èƒ½ã§ã™ã€‚

Configurable rulesã®è¨­å®šã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã§`redocly.yml`ã«è¨­å®šã—ã¾ã™ã€‚è¤‡æ•°ãƒ«ãƒ¼ãƒ«ã§ã‚‚è¨­å®šã§ãã¾ã™ã€‚

```yml
rules:
  rule/my-own-rule-1: ...
  rule/my-own-rule-2: ...

# rulesã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ä»–ã®ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«ç­‰ã¨ä¸¦ã¹ã¦`rule/ä»»æ„ã®ãƒ«ãƒ¼ãƒ«å`ã®ã‚­ãƒ¼åã§è¨˜è¼‰
```

å€‹ã€…ã®ãƒ«ãƒ¼ãƒ«ã¯ã€ä»¥ä¸‹ä¾‹ã«ç¤ºã™ã‚ˆã†ãª[Configurable rule object](https://redocly.com/docs/cli/rules/configurable-rules#configurable-rule-object)ã®å½¢ã«æ²¿ã£ã¦è¨­å®šã—ã¾ã™ã€‚
[OpenAPI node types](https://redocly.com/docs/openapi-visual-reference/openapi-node-types)ã¨ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®çµ„ã¿åˆã‚ã›ã§å¤šæ§˜ãªãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
OpenAPI node typesã¨ã¯ã€OpenAPIã®ä»•æ§˜ã‚’æœ¨æ§‹é€ ã¨ã—ã¦æ‰ãˆã¦ã€Operationã‚„Componentãªã©ã®å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’Nodeã¨ã—ã¦è¡¨ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

```yml
rule/{ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ«ãƒ¼ãƒ«å}:
  subject: # Lintå¯¾è±¡ã‚’ç¤ºã™ã€OpenAPI node typeã‹ anyã€‚ å¿…é ˆã€‚
    # Subject object
    type: PathItem # OpenAPI node typeã€‚å¿…é ˆã€‚
    property: get # OpenAPI node typeã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ¼
    filterInParentKeys: # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¯¾è±¡ã®subjectã®è¦ªã‚­ãƒ¼ã®ãƒªã‚¹ãƒˆ
      - get
    filterOutParentKeys: # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¯¾è±¡ã‹ã‚‰é™¤å¤–ã™ã‚‹subjectã®è¦ªã‚­ãƒ¼ã®ãƒªã‚¹ãƒˆ
      - delete
    matchParentKeys: # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¯¾è±¡ã®sabuejctã®è¦ªã‚­ãƒ¼ã®æ­£æ°—è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒªã‚¹ãƒˆ
      -  /^p/

  assertions: #ã€€ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã€‚å¿…é ˆã€‚
    # Assertion object
    required:
      - '200'
    # ... const, defined, disallowwedãªã©ã€ã•ã¾ã–ã¾ãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒæŒ‡å®šå¯èƒ½

  where: # subjectã®çµã‚Šè¾¼ã¿ã‚’è¡Œã†
    # Where object
    subject: # å¿…é ˆ
      # Subject object
      ...
    assertions: # å¿…é ˆ
      # Assertion object
      ...

  message: "{{assertionName}} failed because the {{subject}} {{property}} didn't meet the assertions: {{problems}}" # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—ã—ãŸã‚‰è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  suggest: # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—è§£æ¶ˆã™ã‚‹ãŸã‚ã®ææ¡ˆãƒªã‚¹ãƒˆ
    - ...
  severity: error # é‡å¤§åº¦ã‚’ç¤ºã™ã€‚error | warn | offã€‚
```

ç°¡æ˜“çš„ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§è¨˜è¼‰ã—ã¦ã¾ã™ãŒã€å¤§ã¾ã‹ã«ã¾ã¨ã‚ã‚‹ã¨`subject`ã«ã‚ˆã£ã¦å¯¾è±¡ã‚’æŒ‡å®šã—ã€`assertions`ã«ã‚ˆã£ã¦ãƒã‚§ãƒƒã‚¯ã™ã‚‹å†…å®¹ã‚’æŒ‡å®šã€ã‚ˆã‚Šç´°ã‹ã„å¯¾è±¡ã®çµã‚Šè¾¼ã¿ã¯`where`ã‚’ç”¨ã„ã‚‹ã¨ã„ã£ãŸå½¢ã«ãªã‚Šã¾ã™ã€‚
æ§‹é€ ã‚’ã–ã£ãã‚Šå›³ã«ã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã§ã—ã‚‡ã†ã‹ã€‚
![Configurable rulesã®æ§‹æˆ](https://storage.googleapis.com/zenn-user-upload/55b01a8038ce-20241211.png)

### ä¾‹

å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚Œã‚‹ã‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å›ºã‚ã‚‹ãŸã‚ã€å®Ÿéš›ã«ä¾‹ã¨ã—ã¦ä»¥ä¸‹3ã¤OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨˜è¿°ã«åˆ¶ç´„ã‚’ã‹ã‘ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚

- `operationId`ã‚’ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã«
- `paths`ã®ãƒ‘ã‚¹ã‚’`$ref`å‚ç…§ã§ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã™ã‚‹ã‚ˆã†ã«
- `204 No Content`ã®å ´åˆã«`content`ã‚’è¨˜è¿°ã—ãªã„ã‚ˆã†ã«

#### `operationId`ã‚’ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã«

ä»–ã®ãƒ„ãƒ¼ãƒ«ï¼ˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«ï¼‰ã§ã‚‚åˆ©ç”¨ã•ã‚Œã‚‹è­˜åˆ¥å­ã§ã‚ã‚‹ç­‰ã‚’è¸ã¾ãˆã¦[`operationId`ã¯ä¸€èˆ¬çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«å¾“ã£ã¦å‘½åã™ã‚‹ã®ãŒæœ›ã¾ã—ã„](https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.1.md#operation-object)ã¨ã•ã‚Œã¾ã™ãŒã€ä»®ã«ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã§çµ±ä¸€ã™ã‚‹ã¨ã—ãŸã‚‰Configurable rulesã§ãƒ«ãƒ¼ãƒ«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```yml
rule/operationid-case:
  subject: 
    type: Operation
    property: operationId
  assertions: 
    casing: camelCase
  message: "OperationIdã¯ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã§å‘½åã—ã¦ãã ã•ã„"
  severity: error
```

ä¸Šè¿°ã®ã‚ˆã†ã«`operationId`ã‚’å¯¾è±¡ã¨ã™ã‚‹OpenAPI node typeã‚’`subject`ã«æŒ‡å®šã—ã¦ã€`assertions`ã§ã¯`casting`ã®`camelCase`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã§ã¯ãªã„`operationId`ãŒä½œã‚‰ã‚Œãªã„ã‚ˆã†ã«Lintã§å¼¾ãã“ã¨ãŒã§ãã¾ã™ã€‚
ä»¥ä¸‹ã¯ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã§è¨˜è¿°ã—ãŸ`operationId`ãŒLintã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸçµæœã§ã™ã€‚

```bash
[18] ../openapi/openapi.yaml:219:20 at #/paths/~1tickets~1{ticketId}~1qr/get/operationId

OperationIdã¯ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã§å‘½åã—ã¦ãã ã•ã„

218 |   entry.
219 | operationId: get_ticket_code
220 | tags:
221 |   - Tickets

Error was generated by the rule/operationid-case rule.
```

ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ä»¥å¤–ã§ã‚‚ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚„ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ãªã©ãŒ`casing`ã«å€¤ã¨ã—ã¦æŒ‡å®šã§ãã¾ã™ã€‚

https://redocly.com/docs/cli/rules/configurable-rules#casing-example

#### `paths`ã®ãƒ‘ã‚¹ã‚’`$ref`å‚ç…§ã§ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã™ã‚‹ã‚ˆã†ã«

OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯[`$ref`](https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.1.md#reference-object)ã«ã‚ˆã£ã¦åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ã€OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«è‚¥å¤§åŒ–ã‚’æŠ‘åˆ¶ã§ãã¾ã™ãŒã€`assertions`ã«`ref`ã‚’æ­£è¦è¡¨ç¾æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¸åˆ†å‰²ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’`$ref`ã§å‚ç…§ã™ã‚‹ã“ã¨ã‚’å¼·åˆ¶ã™ã‚‹ãƒ«ãƒ¼ãƒ«ãŒä½œã‚Œã¾ã™ã€‚

```yml
rule/use-ref-in-paths:
  message: "paths/*.ymlã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç”¨æ„ã—ã¦ã€$refã§å‚ç…§ã—ã¦ãã ã•ã„"
  severity: error
  subject:
    type: PathItem
  assertions:
    ref: /^(\.\/)?paths\/.*\.yml$/
```

ã“ã®ãƒ«ãƒ¼ãƒ«è¨­å®šãŒã‚ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«`/cars/{carId}`ã®`PathItem`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ`paths/`ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ã„ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```bash
[1] ../openapi/openapi.yaml:22:3 at #/paths/~1cars~1{carId}

paths/*.ymlã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç”¨æ„ã—ã¦ã€$refã§å‚ç…§ã—ã¦ãã ã•ã„

20 |
21 | paths:
22 |   /cars/{carId}:
23 |     put:
24 |       summary: Update a car

Error was generated by the rule/use-ref-in-paths rule.
```

`PathItem`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«é™ã‚‰ãš[ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ãˆã‚‹OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.1.md#components-object)ã¯ã€åŒæ§˜ã®ãƒ«ãƒ¼ãƒ«è¨­å®šã«ã‚ˆã£ã¦åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®åˆ†å‰²ã‚’å¼·åˆ¶ã§ããã†ã§ã™ã€‚

#### `204 No Content`ã®å ´åˆã«`content`ã‚’è¨˜è¿°ã—ãªã„ã‚ˆã†ã«

HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ[204](https://developer.mozilla.org/ja/docs/Web/HTTP/Status/204)ã§ã‚ã‚Œã°ã€`content`ã¯è¿”ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒ[HTTPã®ä»•æ§˜](https://www.rfc-editor.org/rfc/rfc9110#status.204)ã‹ã‚‰ã‚‚æœ›ã¾ã—ã„ã¨æ€ã„ã¾ã™ãŒã€ã“ã‚Œã‚‚ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«è¨­å®šã™ã‚‹ã“ã¨ã§é˜²ãã“ã¨ãŒã§ããã†ã§ã™ã€‚

```yml
rule/no-content-for-status-code-204:
  message: "HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ204ã®å ´åˆã€contentã‚’æŒ‡å®šã—ãªã„ã§ãã ã•ã„"
  severity: error
  subject:
    type: Response
    filterInParentKeys:
      - '204'
  assertions:
    disallowed: 
      - content
```

ã“ã®ã‚ˆã†ã«HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹`204`ã®`Response`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’`subject`ã«æŒ‡å®šã—ã¦`content`ã‚’è¨±å¯ã—ãªã„`disallowed`ã‚’`assertions`ã¨ã—ãŸãƒ«ãƒ¼ãƒ«è¨­å®šã™ã‚‹ã¨ã€`204`ã§`content`ã‚’æŒã¤æ§‹é€ ã®OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```bash
[2] ../openapi/openapi.yaml:29:11 at #/paths/~1cars~1{carId}/put/responses/204/content

HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ204ã®å ´åˆã€contentã‚’æŒ‡å®šã—ãªã„ã§ãã ã•ã„

27 | responses:
28 |   "204":
29 |     content:
30 |       application/json:
31 |         schema:

Error was generated by the rule/no-content-for-status-code-204 rule.
```

## ã•ã„ã”ã«

Redocly CLIã«ã‚ˆã£ã¦OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã‚«ã‚¹ã‚¿ãƒ ã®Lintãƒ«ãƒ¼ãƒ«ã‚’Configurable rulesã§è¨­å®šã™ã‚‹æ–¹æ³•ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ãŸã€‚
OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãŸã å˜ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦å‚ç…§ã™ã‚‹ã ã‘ã®å ´åˆã‚„å°è¦æ¨¡ãªé–‹ç™ºã§ã‚ã‚Œã°ã€ã“ã®ã‚ˆã†ãªå¯¾å¿œã®å¿…è¦æ€§ãŒè–„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ä¸€æ–¹ã§ã€ã‚¹ã‚­ãƒ¼ãƒé§†å‹•é–‹ç™ºã«ãŠã„ã¦ã¯OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒéå¸¸ã«é‡è¦ãªå½¹å‰²ã‚’æ‹…ã†ã¨æ€ã†ã®ã§ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã«ã‚ˆã£ã¦å¾—ã‚‰ã‚Œã‚‹ã‚‚ã®ãŒã‚ã‚‹ã®ã§ã‚ã‚Œã°æœ‰åŠ¹æ´»ç”¨ã—ã¦ã„ããŸã„ã‚‚ã®ã§ã™ã€‚
ãŸã ã€`yaml`ã§è¤‡é›‘ãªãƒ«ãƒ¼ãƒ«è¨­å®šï¼ˆä¾‹ãˆã°`where`ã‚’ä½¿ã†ã‚ˆã†ãªï¼‰ã‚’è¡Œã†å ´åˆã¯ã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã§æ§‹é€ ã‚’è¡¨ã™`yaml`ã®ç‰¹æ€§ä¸Šãƒ«ãƒ¼ãƒ«æ§‹é€ ã‚’èª­ã¿å–ã‚Šã¥ã‚‰ããªã‚‹å°è±¡ã‚‚å—ã‘ã¾ã™ã€‚ãã®ã‚ˆã†ãªå ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç”¨æ„ã—ã¦ãƒ«ãƒ¼ãƒ«é©ç”¨ã™ã‚‹æ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## å‚è€ƒ

- [Getting Started | OpenAPI Documentation](https://learn.openapis.org/)
- [Redocly/redocly-cli-cookbook: A community-created collection of configuration, plugins and techniques for getting the best from Redocly CLI in every situation.](https://github.com/Redocly/redocly-cli-cookbook)
- [Redocly's visual reference to OpenAPI](https://redocly.com/docs/openapi-visual-reference)
- [RFC: openapi-typescript v7 built on top of Redocly Â· openapi-ts/openapi-typescript Â· Discussion #1344](https://github.com/openapi-ts/openapi-typescript/discussions/1344)
- [OpenAPI Map](https://openapi-map.apihandyman.io/)
