---
title: "i18n/l10n を整理する"
emoji: "🐈"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["i18n", "l10n"]
published: false
---

ウェブアプリケーションの多言語対応をどのように行うか、i18n（internationalization）およびl10n（localization）について整理して考える。

## i18n、l10nとは何か

そもそもi18nとl10n、それぞれの意味するものは何なのか。大雑把に理解すると以下のような理解で良さそう。

- **i18n**: 多言語対応が可能な状態にアプリケーションを作っておくこと
- **l10n**: 特定の言語（に加えて地域的な特性など）に向けてアプリケーションの機能や文言を適合させること

以下はWikipediaからの引用。

#### i18nとは

> ソフトウェアに機能的な変更や拡張を加えることなく多様な言語や地域に適合できるようにする、ソフトウェア設計の工程。言語や地域に依存しない、仕様の汎用化や共通化を含む。
> https://ja.wikipedia.org/wiki/%E5%9B%BD%E9%9A%9B%E5%8C%96%E3%81%A8%E5%9C%B0%E5%9F%9F%E5%8C%96

#### l10nとは

> 特定の言語または地域固有の文化に応じたソフトウェアコンポーネント（構成部品）や機能を実装したり、ユーザー向けに表示されるメッセージ中の文言を翻訳したりすることによって、ソフトウェアを特定の言語や地域に適合させる工程。
> 外来語として「ローカライズ」「ローカライゼーション」とカナ表記されることのほうが多い。
> https://ja.wikipedia.org/wiki/%E5%9B%BD%E9%9A%9B%E5%8C%96%E3%81%A8%E5%9C%B0%E5%9F%9F%E5%8C%96

なお、g11nはi18nおよびl10n（globalization）の総称となるもの。

> 国際化と地域化両者の概念は時々、集合的にグローバライゼーションまたはグローバリゼーション（アメリカ英語: globalization、イギリス英語: globalisation、G11N）と呼ばれる[注釈 1]。ただし、この言葉はソフトウェア工学の範囲を越えて社会的な国際化の意味で使われることも多い。
> https://ja.wikipedia.org/wiki/%E5%9B%BD%E9%9A%9B%E5%8C%96%E3%81%A8%E5%9C%B0%E5%9F%9F%E5%8C%96

## HTTP

ブラウザが[HTTP](https://developer.mozilla.org/ja/docs/Web/HTTP/Overview)でやりとりする言語に関わるものはどのようになっているのか。

### `Accept-Language`

リクエストヘッダとして`Accept-Language`が送られる。
構文としては、`Accept-Language: 言語タグ(-言語地域のサブタグor文字の種類;q=重みづけの値)`のような形になる。Chromeであれば`chrome://settings/languages`で指定する言語がこの部分にあたる。
このヘッダ指定はあくまでそのように指定するだけであって強制力を伴うわけではない。
実際の`Accept-Language`は以下のような形になる。

```
Accept-Language: ja
```

```
Accept-Language: ja,en-US;q=0.9,en;q=0.8
```

https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Accept-Language

### `Content-Language`

[エンティティヘッダ](https://developer.mozilla.org/ja/docs/Glossary/Entity_header)としては`Content-Language`がある。これはコンテンツがどの言語使用者向けであるかを示すものであって、コンテンツ自体の言語とは別というものになりそう。

> たとえば、ドイツ語スピーカーのための語学コースの一部としての英語が書かれているかもしれません。文書が記述されている言語を示す場合は、代わりに lang 属性を使用します)。
> https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Content-Language

https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Content-Language

## languageとlocale

i18n/l10nを考える上でlanguageとlocaleの違いを整理しておく必要もありそう。

- **language**: これはそのまま言語そのものとして捉えればよい
- **locale**: 翻訳する上で、その地域特有の通貨記号や日付のフォーマットなどを表す

> The first factor, the language, is self-explanatory; this is what will actually be translated. However, there's more than meets the eye with the second factor - locale.
>
> Locale refers to regional settings such as currency symbols or date formats. One cannot simply translate a word for word without considering these additional parameters that make up an entire culture's way of life and understanding of their world around them.
>
> https://simplelocalize.io/blog/posts/language-vs-locale/

日本語から英語に翻訳する上でも、対象の言語だけではなく対象の地域的な特性を考慮しなければ適切な形でl10nはできないというのは、通貨や単位などの違いなどを考えると理解できる。

アプリケーション上の表記としては`en-US`や`ja_JP`のような`language-locale`もしくは`language_locale`の形で表すことになる。

## `Intl`オブジェクト

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Intl

## i18nextを用いたReactアプリケーション

この分野に関して、Reactの場合[react-i18next](https://react.i18next.com/)や[react-intl](https://formatjs.io/docs/react-intl/)など幾つかの選択肢がある。
ここではかなり広く一般的に利用されているであろう`react-i18next`でi18n対応したアプリケーションを用意してみる。

```sh
$ npx create-react-app react-app --template typescript
$ cd react-app
$ npm i -E -D react-i18next i18next
```

`react-i18next`と`i18next`の2つのパッケージが必要になる。
`i18next`が翻訳に関するコア機能を持ち、`react-i18next`がそれをReactで利用できる形にしているパッケージ構成という理解。

https://react.i18next.com/guides/quick-start#install-needed-dependencies

### `i18n.ts`

`i18n.ts`ファイルを`src/`直下に用意する。内容は[公式ドキュメントのクイックスタートガイドのもの](https://react.i18next.com/guides/quick-start#configure-i18next)を少し変更して使う。
`i18n.use(initReactI18next)`によって`i18next`のインスタンスを`react-i18next`が受け取り、Reactコンポーネントでその機能を利用可能にするというもののよう。

```ts:i18n.ts
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'

const resources = {
  en: {
    translation: {
      hello: 'Hello',
    },
  },
  ja: {
    translation: {
      hello: 'こんにちわ',
    },
  },
}

i18n.use(initReactI18next).init({
  resources,
  lng: 'en',

  interpolation: {
    escapeValue: false,
  },
})

export default i18n
```

`index.tsx`でこの`i18n.ts`を`import`しておく。

```diff:index.tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import './index.css'
import App from './App'
import reportWebVitals from './reportWebVitals'

+ import './i18n'

const root = ReactDOM.createRoot(document.getElementById('root') as HTMLElement)
```

`App`コンポーネントで`t`関数を使って`hello`に該当するものを出力してみる。

```diff:App.tsx
import React from 'react'
import logo from './logo.svg'
import './App.css'
+import { useTranslation } from 'react-i18next'

function App() {
+  const { t } = useTranslation()

  return (
    <div className="App">
      <header className="App-header">
        <img src={logo} className="App-logo" alt="logo" />
-        <p>
-          Edit <code>src/App.tsx</code> and save to reload.
-        </p>
+        <p>{t('hello')}</p>
        <a
          className="App-link"
          href="https://reactjs.org"
          target="_blank"
          rel="noopener noreferrer">
          Learn React
        </a>
      </header>
    </div>
  )
}

export default App
```

これでi18n対応可能なアプリケーションが準備できる。

### `i18next`の翻訳は内部的にどのように解決されるか

内部的な解決がどのように行われるかを理解する上で、把握するべき項目は`key`と`language`と`namespace`の3つ。

- **`key`**: キーとそれに対応する値の組み合わせがあって、`key`の指定によって対応する値が得られる`key`を指す。JSONなどのそれをそのままイメージすれば基本的には良いはず。
- **`language`**: どの言語であるかと`key`との組み合わせで翻訳結果を返すためのその言語コード。
- **`namespace`**: アプリケーションにおいて、特定の意味のあるまとまりで区切ってグループ化したものを指す。

ではこれらの要素を理解した上で、具体的にどのような流れで翻訳が解決されるか。基本的には、`namespace`, `language`, `key`の組み合わせにマッチする`key`を利用するが、見つからない場合は類似の`key`や`language`、`namespace`をフォールバック含めて探索する。その上で何も見つからない場合には最終的に`key`そのものを返す。

https://www.i18next.com/principles/translation-resolution

### `i18next`は表示するべき言語をどのように決定するか

`lng`に指定する言語が利用される。

https://www.i18next.com/overview/configuration-options#languages-namespaces-resources

---

- https://github.com/jpomykala/awesome-i18n
- https://www.gala-global.org/knowledge-center/professional-development/articles/5-software-internationalization-i18n-best
- https://en.wikipedia.org/wiki/IETF_language_tag
